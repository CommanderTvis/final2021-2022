//@strict-types

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Срез = РегистрыСведений.СостояниеНоменклатуры.СрезПоследних(Дата,
		Новый Структура(Метаданные.РегистрыСведений.СостояниеНоменклатуры.Измерения.Товар.Имя, Товар));

	Если Срез.Количество() > 0 Тогда
		Если ЗначениеЗаполнено(
			Срез[0][Метаданные.РегистрыСведений.СостояниеНоменклатуры.Ресурсы.СостояниеЭксплуатации.Имя]) Тогда
			СообщенияКлиентСервер.СообщитьСоСвойствами("Товар выведен из эксплуатации.", "Товар", ЭтотОбъект);
			Отказ = Истина;
		КонецЕсли;

		Если ЗначениеЗаполнено(Срез[0][Метаданные.РегистрыСведений.СостояниеНоменклатуры.Ресурсы.Арендатор.Имя]) Тогда
			СообщенияКлиентСервер.СообщитьСоСвойствами("Товар уже арендован.", "Товар", ЭтотОбъект);
			Отказ = Истина;
		КонецЕсли;

		Если Отказ Тогда
			Возврат;
		КонецЕсли;
	КонецЕсли;

//{{__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
	//Данный фрагмент построен конструктором.
	//При повторном использовании конструктора, внесенные вручную данные будут утеряны!

	// регистр СостояниеНоменклатуры
	Движения.СостояниеНоменклатуры.Записывать = Истина;
	Движение = Движения.СостояниеНоменклатуры.Добавить();
	Движение.Период = Дата;
	Движение.Товар = Товар;
	Движение.Арендатор = Клиент;
	Движение.Станция = Справочники.Станции.ПустаяСсылка();
	Движение.СостояниеЭксплуатации = Перечисления.ОснованияВыводаТовараИзЭксплуатации.ПустаяСсылка();

	//}}__КОНСТРУКТОР_ДВИЖЕНИЙ_РЕГИСТРОВ
КонецПроцедуры